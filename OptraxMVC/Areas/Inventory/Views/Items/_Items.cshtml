@using OptraxDAL.Models.Inventory
@model List<InventoryCategory>

@{
    List<InventoryItem> items = ViewBag.Items;
    
}

<div class="tab-div">
    <div class="tab-inner">
        <table class="cat-table w-100">
            <thead class="top-head">
                <tr class="">
                    <th>
                        <div class="d-flex">
                            <button class="toggle-all all me-2 toggle" data-toggle-class="child-row">
                                <span class="show-i"><i class="bi bi-chevron-double-down"></i></span> @* Expand all expandables *@
                                <span class="hide-i d-none"><i class="bi bi-chevron-double-up"></i></span> @* Collapse all collapsables *@
                            </button>
                            <button class="toggle-all cats me-2 toggle" data-toggle-class="child-row">
                                <span class="show-i"><i class="bi bi-chevron-down"></i></span> @* Expand all categories, hide items *@
                                <span class="hide-i d-none"><i class="bi bi-chevron-up"></i></span> @* Collapse all child categories *@
                            </button>
                            <button class="btn-clear"><span class="me-2 text-grn-dk">+</span>Add New Top Level</button>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody id="categoryTable" class="cat-body d-block">
                @foreach (var category in Model.OrderBy(m => m.Name).ToList())
                {
                    List<int> childIDs = category.GetChildIDs();
                    List<InventoryItem> catItems = items.Where(i => childIDs.Contains(i.ID)).ToList(); //where items belong to current cat or any of it's children
                    //items.RemoveAll(i => catItems.Contains(i));

                    var childVD = new ViewDataDictionary(ViewData) { ["Items"] = items };

                    @await Html.PartialAsync("~/Areas/Inventory/Views/Items/_ItemsChild.cshtml", category)
                }
            </tbody>
        </table>
    </div>
</div>

<script src="/js/inventory.js"></script>


